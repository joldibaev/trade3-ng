<!-- Header -->
<div class="flex items-center justify-between">
  <h1 class="h1">Номенклатура товаров</h1>
</div>

<div class="flex flex-1 gap-4 overflow-hidden">
  <!-- Sidebar: Categories -->
  <ui-card class="h-full w-80">
    <div class="default-border-color border-b p-2">
      <div class="flex items-center gap-1">
        <button uiButton variant="ghost" size="sm" (click)="openCategoryDialog()">
          <ui-icon name="outline-plus"></ui-icon>
          <span>Создать</span>
        </button>
        <button
          uiButton
          variant="ghost"
          size="icon"
          [disabled]="!selectedCategoryId()"
          (click)="editCurrentCategory()"
        >
          <ui-icon name="outline-edit"></ui-icon>
        </button>
        <button
          uiButton
          variant="danger"
          size="icon"
          [disabled]="!selectedCategoryId()"
          (click)="deleteCurrentCategory()"
        >
          <ui-icon name="outline-trash"></ui-icon>
        </button>
      </div>
    </div>

    <div class="flex-1 overflow-y-auto p-2">
      @if (categories.isLoading()) {
        <div class="flex justify-center p-4">
          <ui-loading [width]="20" [height]="20" />
        </div>
      } @else if (categories.hasValue()) {
        <ui-tree [items]="rootCategories()" [(selected)]="selectedTree" />
      }
    </div>
  </ui-card>

  <!-- Main Content: Products Table -->
  <ui-card class="flex-1 overflow-hidden">
    <!-- Toolbar -->
    <div class="default-border-color flex items-center justify-between border-b p-2">
      <div class="flex items-center gap-2">
        <button uiButton variant="ghost" size="sm" (click)="openProductDialog()">
          <ui-icon name="outline-plus"></ui-icon>
          <span>Создать</span>
        </button>
        <button
          uiButton
          variant="ghost"
          size="icon"
          [disabled]="!selectedProduct()"
          (click)="openProductPage()"
        >
          <ui-icon name="outline-eye"></ui-icon>
        </button>
        <button
          uiButton
          variant="ghost"
          size="icon"
          [disabled]="!selectedProduct()"
          (click)="editCurrentProduct()"
        >
          <ui-icon name="outline-edit"></ui-icon>
        </button>
        <button
          uiButton
          variant="danger"
          size="icon"
          [disabled]="!selectedProduct()"
          (click)="deleteCurrentProduct()"
        >
          <ui-icon name="outline-trash"></ui-icon>
        </button>

        <!-- v-line -->
        <div class="mx-1 h-4 w-px bg-slate-300"></div>

        @if (isSearchVisible()) {
          <div
            class="animate-in fade-in slide-in-from-right-4 flex items-center gap-1 duration-300"
          >
            <ui-input
              type="search"
              placeholder="Поиск..."
              class="w-64"
              [formField]="formData.query"
            />
            <button
              uiButton
              variant="ghost"
              size="icon"
              (click)="isSearchVisible.set(false); formData.query().reset('')"
            >
              <ui-icon name="outline-x"></ui-icon>
            </button>
          </div>
        } @else {
          <button uiButton variant="ghost" size="sm" (click)="isSearchVisible.set(true)">
            <ui-icon name="outline-search"></ui-icon>
            <span>Найти</span>
          </button>
        }
      </div>
    </div>

    <!-- Filters Row (Mockup based on screenshot) -->
    <div class="default-border-color border-b bg-slate-50 p-2 text-xs">
      <div class="flex items-center gap-4">
        <div class="flex items-center gap-1">
          <span class="text-slate-500">Склад/Магазин:</span>
          <span class="default-border-color border-b border-dashed font-medium text-slate-900"
            >Все</span
          >
          <ui-icon name="outline-x" class="h-3 w-3 cursor-pointer text-slate-400" />
        </div>
        <div class="flex items-center gap-1">
          <span class="text-slate-500">Вид цены:</span>
          <span class="default-border-color border-b border-dashed font-medium text-slate-900"
            >Розничная</span
          >
          <ui-icon name="outline-x" class="h-3 w-3 cursor-pointer text-slate-400" />
        </div>
      </div>
    </div>

    <ui-table
      [columns]="columns()"
      [trackField]="'id'"
      [data]="filteredProducts()"
      [loading]="products.isLoading()"
      (selectedChanged)="selectedProduct.set($event)"
    />
  </ui-card>
</div>
