@if (product.isLoading()) {
  <div class="flex h-64 items-center justify-center">
    <ui-loading [width]="40" [height]="40" />
  </div>
} @else if (product.value(); as p) {
  <ui-page-header [title]="product.value()?.name || '...'" [showBack]="true">
    <!-- Actions can be added later -->
  </ui-page-header>

  <ui-tab-group class="mt-4">
    <!-- General Info -->
    <ui-tab label="Общее">
      <div class="mt-6 space-y-8">
        <!-- General Info Section -->
        <div>
          <h2 class="mb-4 text-lg font-semibold">Общая информация</h2>
          <div class="grid grid-cols-2 gap-4 text-sm">
            <div class="text-neutral-500">ID:</div>
            <div class="font-medium">{{ p.id }}</div>

            <div class="text-neutral-500">Артикул:</div>
            <div class="font-medium">{{ p.article || '-' }}</div>

            <div class="text-neutral-500">Категория:</div>
            <div class="font-medium">{{ p.category.name || 'Без категории' }}</div>

            @if (p.prices.length) {
              @for (price of p.prices; track price.id) {
                <div class="text-neutral-500">{{ getPriceTypeName(price.priceTypeId) }}:</div>
                <div class="font-medium">{{ price.value | number }} UZS</div>
              }
            }

            @if (p.stocks.length) {
              @for (stock of p.stocks; track stock.id) {
                <div class="text-neutral-500">{{ getStoreName(stock.storeId) }}:</div>
                <div class="font-medium">{{ stock.quantity }} шт</div>
              }
            }
          </div>
        </div>
      </div>
    </ui-tab>

    <!-- Barcodes -->
    <ui-tab label="Штрихкоды">
      <div class="mt-6">
        <h2 class="mb-4 text-lg font-semibold">Штрихкоды</h2>
        @if (p.barcodes.length) {
          <div class="flex flex-wrap gap-2">
            @for (code of p.barcodes; track code.id) {
              <div
                class="rounded-md border border-neutral-200 bg-neutral-50 px-3 py-1 text-sm font-medium"
              >
                {{ code.value }}
              </div>
            }
          </div>
        } @else {
          <div class="text-neutral-500">Штрихкоды не заданы</div>
        }
      </div>
    </ui-tab>

    <!-- Prices (History) -->
    <ui-tab label="История цен">
      <div class="mt-6">
        <h2 class="mb-4 text-lg font-semibold">История цен</h2>
        <ui-table
          [columns]="priceHistoryColumns"
          [data]="product.value()?.priceHistory || []"
          [loading]="product.isLoading()"
          [trackField]="'id'"
        />
      </div>
    </ui-tab>

    <!-- Stock Movements -->
    <ui-tab label="Движение товара">
      <div class="mt-6">
        <h2 class="mb-4 text-lg font-semibold">Движение товара</h2>
        <ui-table
          [columns]="stockMovementColumns"
          [data]="stockMovements.value() || []"
          [loading]="stockMovements.isLoading()"
          [trackField]="'id'"
        />
      </div>
    </ui-tab>
  </ui-tab-group>
} @else {
  <ui-page-header title="Товар не найден" [showBack]="true" />
  <div class="flex h-64 items-center justify-center text-neutral-500">
    Товар не найден или был удален
  </div>
}
