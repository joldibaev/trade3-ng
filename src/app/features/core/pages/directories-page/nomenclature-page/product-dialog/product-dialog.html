<ui-dialog>
  <div class="mb-4 flex items-center justify-between">
    <h2 class="text-lg font-bold">{{ isEdit() ? 'Редактировать товар' : 'Создать товар' }}</h2>
    <button uiButton variant="ghost" icon="x" size="icon" (click)="close()">
      <span class="sr-only">Закрыть</span>
    </button>
  </div>

  <div class="flex flex-col gap-4">
    <ui-input label="Наименование" placeholder="Введите название товара" [field]="formData.name" />
    <ui-input label="Артикул" placeholder="Введите артикул" [field]="formData.article" />

    <div class="flex flex-col gap-1.5">
      <ui-select
        label="Категория"
        [selectField]="'id'"
        [selectedList]="selectedCategoryList()"
        [items]="categories.value()"
        [labelField]="'name'"
        [loading]="categories.isLoading()"
        (selectedListChange)="handleCategoryChange($event)"
      ></ui-select>
    </div>

    <div class="flex flex-col gap-2">
      <div class="text-xs font-medium text-gray-700">Штрихкоды</div>

      <div class="flex flex-wrap gap-2">
        @for (barcode of barcodes(); track barcode.value; let i = $index) {
          <div class="flex items-center gap-1 rounded bg-gray-100 px-2 py-1 text-sm text-gray-800">
            <span>{{ barcode.value }}</span>
            <button
              type="button"
              class="text-gray-500 hover:text-red-500"
              (click)="removeBarcode(i)"
            >
              <ui-icon name="x" size="14" />
              <span class="sr-only">Удалить штрихкод</span>
            </button>
          </div>
        }
      </div>

      <div class="flex items-end gap-2">
        <ui-input
          placeholder="Введите штрихкод"
          class="flex-1"
          [value]="newBarcode()"
          (valueChange)="newBarcode.set($event.toString())"
          (keyup.enter)="addBarcode()"
        />
        <button
          uiButton
          variant="secondary"
          icon="plus"
          size="icon"
          [disabled]="!newBarcode()"
          (click)="addBarcode()"
        >
          <span class="sr-only">Добавить штрихкод</span>
        </button>
      </div>
    </div>
  </div>

  <div class="mt-6 flex justify-end gap-2">
    <button uiButton variant="ghost" (click)="close()">Отмена</button>
    <button uiButton variant="primary" [disabled]="!formData().valid()" (click)="save()">
      Сохранить
    </button>
  </div>
</ui-dialog>
