<ui-dialog [title]="isEdit() ? 'Редактировать товар' : 'Создать товар'" (closeAction)="close()">
  <form id="product-form" class="flex flex-col gap-4" (ngSubmit)="save()">
    <ui-input
      label="Наименование"
      placeholder="Введите название товара"
      [formField]="formData.name"
    />
    <ui-input label="Артикул" placeholder="Введите артикул" [formField]="formData.article" />

    <div class="flex flex-col gap-1.5">
      <ui-select
        label="Категория"
        [optionField]="'id'"
        [formField]="formData.categoryId"
        [items]="categories.value()"
        [optionLabel]="'name'"
        [loading]="categories.isLoading()"
      ></ui-select>
    </div>

    <div class="flex flex-col gap-2">
      <div class="text-xs font-medium text-slate-700">Остатки по складам</div>
      @if (stores.isLoading()) {
        <ui-loading [width]="20" [height]="20" />
      } @else {
        <div class="flex flex-col gap-1 rounded bg-slate-50 p-2 text-sm">
          @for (store of stores.value(); track store.id) {
            @let stock = getStock(store.id);
            <div class="flex justify-between">
              <span class="text-slate-600">{{ store.name }}:</span>
              <span class="font-medium">{{ stock?.quantity || 0 }} шт</span>
            </div>
          }
        </div>
      }
    </div>

    <div class="flex flex-col gap-2">
      <div class="text-xs font-medium text-slate-700">Штрихкоды</div>

      <div class="flex flex-wrap gap-2">
        @for (barcode of barcodes(); track barcode.value; let i = $index) {
          <div
            class="flex items-center gap-1 rounded bg-slate-100 px-2 py-1 text-sm text-slate-800"
          >
            <span>{{ barcode.value }}</span>
            <button
              type="button"
              class="text-slate-500 hover:text-red-500"
              (click)="removeBarcode(i)"
            >
              <ui-icon name="outline-x" size="14" />
              <span class="sr-only">Удалить штрихкод</span>
            </button>
          </div>
        }
      </div>

      <div class="flex items-end gap-2">
        <ui-input
          placeholder="Введите штрихкод"
          class="flex-1"
          [formField]="newBarcodeForm.value"
          (keydown.enter)="$event.preventDefault(); addBarcode()"
        />
        <button
          type="button"
          uiButton
          variant="secondary"
          icon="outline-plus"
          size="icon"
          [disabled]="!newBarcodeState().value"
          (click)="addBarcode()"
        >
          <span class="sr-only">Добавить штрихкод</span>
        </button>
      </div>
    </div>
  </form>

  <button footer type="button" uiButton variant="ghost" (click)="close()">Отмена</button>
  <button
    footer
    type="submit"
    form="product-form"
    uiButton
    variant="primary"
    [disabled]="!formData().valid()"
    [loading]="loading()"
  >
    Сохранить
  </button>
</ui-dialog>
