<!-- Header -->
<div class="flex items-center justify-between">
  <ui-title title="Клиенты" caption="Управление базой клиентов" />

  <button uiButton variant="primary" icon="outline-plus" (click)="openClientDialog()">
    Добавить клиента
  </button>
</div>

@if (clients.isLoading()) {
  <div class="flex h-64 items-center justify-center">
    <ui-loading [width]="40" [height]="40" />
  </div>
} @else {
  <!-- Stats Cards -->
  <div class="grid grid-cols-1 gap-6 md:grid-cols-4">
    @for (stat of stats(); track stat.label) {
      <ui-stat-card
        [label]="stat.label"
        [value]="stat.value"
        [icon]="stat.icon"
        [color]="stat.color"
      />
    }
  </div>

  <!-- Search Area -->
  <div class="grid grid-cols-1 gap-6 md:grid-cols-4">
    <ui-input
      placeholder="Поиск по имени, email или местоположению..."
      class="lg:col-span-1"
      [formField]="searchForm.query"
    ></ui-input>
  </div>

  <!-- Data Table -->
  <ui-card>
    <ui-table [dataSource]="filteredClients()">
      <ng-container cdkColumnDef="name">
        <th *cdkHeaderCellDef cdk-header-cell>Имя клиента</th>
        <td *cdkCellDef="let element" cdk-cell>
          <div class="flex items-center gap-3 py-2">
            <!-- icon -->
            <div
              class="from-primary-500 to-primary-600 flex h-10 w-10 shrink-0 items-center justify-center rounded-full bg-linear-to-br text-white shadow-sm"
            >
              <ui-icon name="outline-users" width="20" height="20" />
            </div>

            <div class="flex flex-col">
              <span class="font-semibold">{{ element.name }}</span>
              <span class="text-xs text-slate-500">{{ element.id }}</span>
            </div>
          </div>
        </td>
      </ng-container>

      <ng-container cdkColumnDef="email">
        <th *cdkHeaderCellDef cdk-header-cell style="width: 160px">Телефон</th>
        <td *cdkCellDef="let element" cdk-cell>
          <div class="flex items-center gap-2">
            <ui-icon width="16" height="16" name="outline-mail" class="text-slate-400" />
            <span>{{ element.email || '-' }}</span>
          </div>
        </td>
      </ng-container>

      <ng-container cdkColumnDef="phone">
        <th *cdkHeaderCellDef cdk-header-cell style="width: 160px">Телефон</th>
        <td *cdkCellDef="let element" cdk-cell>
          <div class="flex items-center gap-2">
            <ui-icon width="16" height="16" name="outline-phone" class="text-slate-400" />
            <span>{{ element.phone || '-' }}</span>
          </div>
        </td>
      </ng-container>

      <ng-container cdkColumnDef="address">
        <th *cdkHeaderCellDef cdk-header-cell style="width: 200px">Местоположение</th>
        <td *cdkCellDef="let element" cdk-cell>
          <div class="flex items-center gap-2">
            <ui-icon width="16" height="16" name="outline-map-pin" class="text-slate-400" />
            <span>{{ element.address || '-' }}</span>
          </div>
        </td>
      </ng-container>

      <ng-container cdkColumnDef="isActive">
        <th *cdkHeaderCellDef cdk-header-cell style="width: 120px">Статус</th>
        <td *cdkCellDef="let element" cdk-cell>
          <ui-badge [variant]="element.isActive ? 'success' : 'neutral'">
            {{ element.isActive ? 'Активен' : 'Неактивен' }}
          </ui-badge>
        </td>
      </ng-container>

      <ng-container cdkColumnDef="action">
        <th *cdkHeaderCellDef cdk-header-cell style="width: 140px"></th>
        <td *cdkCellDef="let element" cdk-cell>
          <div class="flex items-center justify-end gap-1">
            <button
              uiButton
              variant="ghost"
              size="sm"
              iconOnly
              icon="outline-edit"
              (click)="openClientDialog(element)"
            ></button>
            <button
              uiButton
              variant="danger"
              size="sm"
              iconOnly
              icon="outline-trash"
              (click)="deleteClient(element)"
            ></button>
          </div>
        </td>
      </ng-container>

      <tr *cdkHeaderRowDef="displayedColumns" cdk-header-row></tr>
      <tr *cdkRowDef="let row; columns: displayedColumns" cdk-row></tr>

      <tr *cdkNoDataRow>
        <td [attr.colspan]="displayedColumns.length">
          <ui-empty-state
            title="Клиенты не найдены"
            icon="outline-users"
            description="Попробуйте изменить параметры поиска"
          />
        </td>
      </tr>
    </ui-table>
  </ui-card>
}
