<!-- Header -->
<div class="flex flex-col justify-between gap-4 sm:flex-row sm:items-center">
  <div>
    <h1 class="text-2xl font-bold tracking-tight text-slate-900">Поставщики</h1>
    <p class="text-sm text-slate-500">Управляйте списком поставщиков и их данными</p>
  </div>
  <button uiButton variant="primary" icon="outline-plus" (click)="openVendorDialog()">
    Добавить поставщика
  </button>
</div>

@if (vendors.isLoading()) {
  <div class="flex h-64 items-center justify-center">
    <ui-loading [width]="40" [height]="40" />
  </div>
} @else {
  <!-- Stats Cards -->
  <div class="grid grid-cols-1 gap-6 md:grid-cols-4">
    @for (stat of stats(); track stat.label) {
      <ui-card class="flex items-center gap-4 p-6">
        <div
          class="flex h-12 w-12 shrink-0 items-center justify-center rounded-xl bg-emerald-50 text-emerald-600"
        >
          <ui-icon width="24" height="24" [name]="stat.icon" />
        </div>

        <div>
          <p class="text-sm font-medium text-slate-500">{{ stat.label }}</p>
          @if (stat.label === 'Общие закупки') {
            <p class="text-2xl font-bold text-slate-900">{{ stat.value | number: '1.0-0' }} UZS</p>
          } @else {
            <p class="text-2xl font-bold text-slate-900">{{ stat.value }}</p>
          }
        </div>
      </ui-card>
    }
  </div>

  <!-- Search Area -->
  <div class="grid grid-cols-1 gap-6 md:grid-cols-4">
    <ui-input
      placeholder="Поиск по имени, email или местоположению..."
      class="lg:col-span-1"
      [formField]="searchForm.query"
    ></ui-input>
  </div>

  <!-- Data Table -->
  <ui-card>
    <ui-table [loading]="vendors.isLoading()" [isEmpty]="!filteredVendors().length">
      <tr header>
        <th style="width: 120px">ID</th>
        <th>Наименование</th>
        <th style="width: 160px">Телефон</th>
        <th style="width: 200px">Адрес</th>
        <th style="width: 120px">Статус</th>
        <th style="width: 140px" class="text-right">Действия</th>
      </tr>

      @for (row of filteredVendors(); track row.id) {
        <tr class="hover:bg-slate-50/50">
          <!-- Code -->
          <td>
            <div class="group flex items-center gap-2">
              <span class="font-mono text-xs font-semibold text-slate-500" [title]="row.id">
                ...{{ row.id | toString | slice: -10 }}
              </span>
              <button
                uiButton
                variant="ghost"
                icon="outline-copy"
                iconOnly
                size="sm"
                type="button"
                title="Копировать ID"
                class="opacity-0 group-hover:opacity-100"
                (click)="$event.stopPropagation(); copyToClipboard(row.id)"
              ></button>
            </div>
          </td>

          <!-- Name -->
          <td>
            <div class="flex items-center gap-3 py-2">
              <div
                class="flex h-10 w-10 items-center justify-center rounded-full bg-linear-to-br from-purple-500 to-purple-600 text-white shadow-sm"
              >
                <ui-icon name="outline-users" width="20" height="20" />
              </div>
              <div class="flex flex-col">
                <span class="font-medium text-slate-900">{{ row.name }}</span>
                @if (row.email) {
                  <div class="flex items-center gap-1 text-xs text-slate-500">
                    <ui-icon name="outline-mail" width="12" height="12" />
                    <span>{{ row.email }}</span>
                  </div>
                }
              </div>
            </div>
          </td>

          <!-- Phone -->
          <td>
            <div class="flex items-center gap-2">
              <ui-icon width="16" height="16" name="outline-phone" class="text-slate-400" />
              <span class="truncate">{{ row.phone || '-' }}</span>
            </div>
          </td>

          <!-- Address -->
          <td>
            <div class="flex items-center gap-2">
              <ui-icon width="16" height="16" name="outline-map-pin" class="text-slate-400" />
              <span class="truncate">{{ row.address || '-' }}</span>
            </div>
          </td>

          <!-- Status -->
          <td>
            <ui-badge [variant]="row.isActive ? 'success' : 'neutral'">
              {{ row.isActive ? 'Активен' : 'Неактивен' }}
            </ui-badge>
          </td>

          <!-- Actions -->
          <td class="text-right">
            <div class="flex items-center justify-end gap-1">
              <button
                uiButton
                variant="ghost"
                size="sm"
                iconOnly
                icon="outline-edit"
                (click)="openVendorDialog(row)"
              ></button>
              <button
                uiButton
                size="sm"
                iconOnly
                variant="danger"
                icon="outline-trash"
                (click)="deleteVendor(row)"
              ></button>
            </div>
          </td>
        </tr>
      }
    </ui-table>
  </ui-card>
}
