<ui-dialog [title]="data.item ? 'Редактировать товар' : 'Добавить товар'" (closeAction)="cancel()">
  <div class="flex flex-col gap-4">
    <!-- Product -->
    <div class="flex flex-col gap-2">
      @if (selectedProduct(); as product) {
        <!-- Product Card -->
        <div class="rounded-lg border border-slate-200 bg-slate-50 p-4">
          <div class="flex items-start justify-between">
            <div class="flex flex-col gap-2">
              <div class="font-bold text-slate-900">{{ product.name }}</div>
              <div>
                @if (product.article) {
                  <div class="text-xs text-slate-500">Артикул: {{ product.article }}</div>
                }

                @if (product.category) {
                  <div class="text-xs text-slate-500">Категория: {{ product.category.name }}</div>
                }
              </div>
              <div class="text-xs text-slate-500">Остаток: {{ totalStock() }}</div>

              @if (product.prices.length > 0) {
                <div class="mt-2 flex flex-col gap-1">
                  @for (price of product.prices; track price.id) {
                    <div class="text-[11px] text-slate-500">
                      {{ getPriceTypeName(price.priceTypeId) }}:
                      <span class="font-semibold text-slate-700">
                        {{ price.value | currency: 'UZS' : 'symbol-narrow' }}
                      </span>
                    </div>
                  }
                </div>
              }
            </div>
          </div>
        </div>
      } @else {
        <!-- Skeleton or Loading state if needed, though usually fast -->
        <div class="h-24 w-full animate-pulse rounded-lg bg-slate-100"></div>
      }

      <!-- Main Fields -->
      <div class="grid grid-cols-2 gap-4">
        <ui-input-number label="Количество" type="number" [formField]="formData.quantity" />
        <ui-input-number label="Цена закупа" type="number" [formField]="formData.price" />
      </div>

      <!-- Dynamic Prices (Optional) -->
      @if (priceTypes().length) {
        <div class="flex flex-col gap-4 rounded-lg border border-slate-200 bg-slate-50 p-4">
          <div class="flex items-center gap-2">
            <ui-icon name="outline-tag" class="text-slate-500" />
            <ui-checkbox label="Установить новые цены продажи" [(checked)]="isPriceUpdateEnabled" />
          </div>

          @if (isPriceUpdateEnabled()) {
            <div class="grid grid-cols-2 gap-4">
              @for (pt of priceTypes(); track pt.id) {
                <div class="flex flex-col gap-2">
                  <ui-input
                    type="number"
                    [label]="pt.name"
                    [value]="getPriceValue(pt.id).toString()"
                    (valueChange)="updatePrice(pt.id, +$event)"
                  />
                </div>
              }
            </div>
          }
        </div>
      }
    </div>
  </div>

  <button footer uiButton variant="ghost" (click)="cancel()">Отмена</button>
  <button footer uiButton variant="primary" (click)="save()">Сохранить</button>
</ui-dialog>
