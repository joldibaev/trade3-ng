<h2 class="mb-6 text-xl font-bold">
  {{ data.item ? 'Редактировать товар' : 'Добавить товар' }}
</h2>

<div class="flex flex-col gap-4">
  <!-- Product -->
  <div class="flex flex-col gap-2">
    @if (selectedProductName(); as name) {
      <div
        class="flex items-center justify-between rounded-lg border border-neutral-200 bg-neutral-50 p-2 pl-3"
      >
        <span class="font-medium text-neutral-900">{{ name }}</span>
        <button
          uiButton
          variant="ghost"
          size="icon"
          class="text-neutral-400 hover:text-neutral-600"
          (click)="clearProduct()"
        >
          <ui-icon name="outline-x" class="size-4" />
        </button>
      </div>
    } @else {
      <ui-autocomplete
        label="Товар"
        optionField="id"
        optionLabel="name"
        placeholder="Выберите товар"
        filterMode="manual"
        class="w-full"
        [debounce]="500"
        [loading]="products.isLoading()"
        [formField]="formData.productId"
        [items]="products.value()"
        [(query)]="searchQuery"
        (valueChange)="onProductSelect($event)"
      />
    }
  </div>

  <div class="grid grid-cols-2 gap-4">
    <ui-input label="Количество" type="number" [formField]="formData.quantity" />
    <ui-input label="Цена закупа" type="number" [formField]="formData.price" />
  </div>

  <!-- Dynamic Prices -->
  @if (priceTypes().length) {
    <div class="default-border-color border-t pt-4">
      <div class="grid grid-cols-2 gap-4">
        @for (pt of priceTypes(); track pt.id) {
          <div class="flex flex-col gap-2">
            <ui-input
              type="number"
              [label]="pt.name"
              [value]="getPriceValue(pt.id).toString()"
              (valueChange)="updatePrice(pt.id, +$event)"
            />
          </div>
        }
      </div>
    </div>
  }

  <div class="mt-6 flex justify-end gap-3">
    <button uiButton variant="ghost" (click)="cancel()">Отмена</button>
    <button uiButton variant="primary" (click)="save()">Сохранить</button>
  </div>
</div>
