<div #tree="ngTree" ngTree class="flex flex-col gap-1" [nav]="true" [(values)]="selected">
  <ng-template
    [ngTemplateOutlet]="treeNodeTemplate"
    [ngTemplateOutletContext]="{ nodes: items(), parent: tree }"
  />
</div>

<ng-template #treeNodeTemplate let-nodes="nodes" let-parent="parent">
  @for (node of nodes; track node.label) {
    <a
      #treeItem="ngTreeItem"
      uiButton
      variant="ghost"
      ngTreeItem
      align="start"
      routerLinkActive="active"
      class="w-full outline-none"
      [queryParams]="node.queryParams"
      [queryParamsHandling]="node.queryParamsHandling"
      [icon]="node.icon"
      [value]="node.id"
      [parent]="parent"
      [routerLink]="node.routerLink"
      [label]="node.label"
      [routerLinkActiveOptions]="{ exact: true }"
      [selectable]="!node.children.length"
      [(expanded)]="node.expanded"
    >
      {{ node.label }}

      @if (node.children.length) {
        <ui-icon
          name="outline-chevron-down"
          class="ms-auto transition-transform duration-200"
          [class.-rotate-90]="!node.expanded"
        ></ui-icon>
      }
    </a>

    @if (node.children.length) {
      <ul role="group" class="default-border-color ms-7 border-s ps-2">
        <ng-template #group="ngTreeItemGroup" ngTreeItemGroup [ownedBy]="treeItem">
          <ng-template
            [ngTemplateOutlet]="treeNodeTemplate"
            [ngTemplateOutletContext]="{ nodes: node.children, parent: group }"
          />
        </ng-template>
      </ul>
    }
  }
</ng-template>
